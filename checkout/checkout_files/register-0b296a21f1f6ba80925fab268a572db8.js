require(["common","jquery.ui"],function(){require(["destination/register.main"])}),define("destination/register",function(){}),define("register/shared",["jquery","jquery.validate","i18next","standards/dropdown","standards/form","standards/validation","standards/validation/passwordNew","standards/tooltip"],function(e,t,n,r,i,s,o,u){function a(){var t=e("body"),n=e("#v-s-main"),s=n.find("#v-enrollment-form"),a=s.find("#v-account-info"),f=a.find("#vuser_countryCode"),l=a.find("#vuser_languageCode"),c=s.find("#v-username-info"),h=c.find("#vuser_userName"),p=c.find('label[for="vuser_userName"]'),d=s.find("#spanish_label_aggrement.agreement-label"),v=s.find("#regular_label_aggrement.agreement-label"),m=c.find("#vuser_emailAddress"),g=n.find("#vuser_terms_accepted"),y=n.find("#vuser_ecd_accepted"),b=t.find(".v-privacy-link"),w=t.find(".v-tos-link"),E=t.find(".v-ecd-link"),S=s.find(".v-v-question:first").children().clone().slice(1),x,T=f.val(),N=l.val(),C=function(t){require(["visa/config"],function(e){var n=e.countryLocaleMap[t],r=l.val().substring(0,2);n.indexOf(r)===-1&&(r=n[0]),window.location="?country="+t+"&locale="+r})},k=function(n){w.each(function(t,r){e(r).attr("href",n.updated_terms_link)}),b.each(function(t,r){e(r).attr("href",n.updated_privacy_link)}),E.each(function(t,r){e(r).attr("href",n.updated_electronic_link)})},L=function(){var t=h.val()||"",n=f.val()||"US",r={us:"v-v-phone-us",ca:"v-v-phone-ca",au:"v-v-mobile-au"},i=r[n.toLowerCase()],s=["v-v-email"];e.each(r,function(e,t){s.push(t)}),t===""?h.removeClass(s.join(" ")):i!=undefined&&/^\d+$/.test(t.replace(/[ \(\)\-\.\+]/g,""))?(h.removeClass(s.join(" ")).addClass(i),t=t.replace(/\D/g,""),h.hasClass(r.us)||h.hasClass(r.ca)?t=t.replace(/^1?(\d{3})(\d{3})(\d+)$/,"$1$2$3"):(t=t.replace(/^(?:61)/,"0"),t=t.replace(/^(\d{4})(\d{3})(\d+)/,"$1$2$3")),h.val(t)):i==undefined?(h.removeClass(s.join(" ")).removeClass("v-s-error"),h.addClass("v-v-email")):h.removeClass(i).addClass("v-v-email")},A=function(t,n){var r=!1;return t==="country"&&T===n&&(r=!0),t==="language"&&N===n&&(r=!0),r};s.on("blur",".v-v-challenge",function(t){var n=s.find(".v-v-challenge").not(this);e.trim(n.val())&&n.valid()}),s.on("click","#v-enroll-button",function(e){x=!0}),r(f,{autoWidth:!1,iconEnabled:!0,change:function(t){var n=["CA","US","AU"];e.inArray(t,n)<0?p.text(e.i18n.t("lbl_username_email")):p.text(e.i18n.t("lbl_username_email_or_mobile"));var r=["AR","CL","MX","PE"];e.inArray(t,r)<0?(v.removeClass("hidden-label"),d.addClass("hidden-label")):(v.addClass("hidden-label"),d.removeClass("hidden-label")),A("country",t)?e.getJSON("/get_country/"+t+"?locale="+e.i18n.locale,function(e){k(e)}):(e(document).trigger("Vme.Events.CountryChanged",[t]),s.attr("class","v-s-form v-country-"+t.toLowerCase()),g.attr("checked",!1),y.attr("checked",!1),e.getJSON("/get_country/"+t,function(e){k(e)}),l.length>0&&C(t),L())}}),l.length>0&&r(l,{autoWidth:!1,change:function(e){A("language",e)||(window.location="?country="+f.val()+"&locale="+e)}}),r(s.find("#v-security-info"),{autoWidth:!1,change:function(t){var n=s.find(".v-v-question").not(this),r=n.val(),i=n.children().first();e.merge(i,e.grep(S.clone(),function(e){return!e.value||e.value!==t})),n.empty().append(i),n.val(r),n.dropkick("reload"),x&&e(this).valid()}}),n.on("change","#v-enrollment-form .v-v-username",function(){L(),h.val()===""||h.hasClass("v-v-email")?(m.parent(".v-s-field").addClass("v-hidden"),m.attr("disabled","disabled")):(m.parent(".v-s-field").removeClass("v-hidden"),m.removeAttr("disabled"),m.val(""))}),h.trigger("change"),i.init(n),o.init(n,{useTooltip:!1,useErrorList:!0,useStrengthMeter:!1}),u.init()}return{init:a}}),define("register/ad_tracking",["jquery"],function(e){e.fn.insertTrackingMarkup=function(t){return require(["visa/config"],function(n){var r=e(n.adTrackingMarkup);if(typeof t=="function"){var i=window.setTimeout(t,2e3);r.load(function(){window.clearTimeout(i),t.call()})}e("body").append(r)}),!0}}),define("destination/register.main",["jquery","jquery.validate","standards/modal","register/shared","register/ad_tracking","standards/unica","standards/tooltip"],function(e,t,n,r,i,s,o){var u=e(".v-s-content"),a=u.find(".v-privacy-info"),f=u.find("#vuser_ecd_accepted"),l=u.find("#REMEMBER_ME"),c=e("#v-message .v-s-notification"),h=u.find("#vuser_countryCode"),p=0,d,v;!!c.text()&&c.text().trim().length>0&&(c.attr("tabindex","0"),c.focus(),setTimeout(function(){e("#v-s-main .v-s-message").clearFlashMessage(),e("#vuser_firstName").focus()},1e4));var m=function(t,n){n=n||!1,v=window.setTimeout(function(){v&&d.dialog("close")},n?0:1e3)},g=function(){window.clearTimeout(v),v=!1},y=function(){e.get("privacy",function(t){d=e(e.trim(t)),d.dialog(n.extend({width:465,autoFocus:!1,keepFocus:!1,modal:!1,appendTo:"#v-privacy-tooltip",position:{my:"left+50% top-70%",at:"left top",of:"#vuser_terms_accepted",collision:"none"}})),d.parent().on("mouseenter",g).on("mouseleave",m),a.on("mouseenter focus",function(){g(),d.dialog("open"),d.parent().show()}).on("mouseleave",m).on("keydown",function(e){e.which===9&&e.shiftKey&&m(e,!0)}),f.on("focus",function(e){m(e,!0)})})},b=function(t){t=t||u.find("#vuser_countryCode").val(),t.toLowerCase()==="us"&&!d&&y()};e(document).on("Vme.Events.CountryChanged",function(e,t){b(t)}),e("#v-enrollment-form").on("click","#v-enroll-button",function(t){t.preventDefault();var n=e("#v-enrollment-form");n.valid()&&(l.is(":checked")&&s.sendEvent("ev=remember_username_on"),s.sendEvent("ev=enrollment_country&enrollment_country="+h.find("option:selected").val()),n.insertTrackingMarkup(function(){n.submit()}))}),u.on("focus","#vuser_password",function(){p=(new Date).getTime()/1e3}),u.on("blur","#vuser_password",function(e){p=((new Date).getTime()/1e3-p).toFixed(2),s.sendEvent("ev=password_entered&entry_time="+p)}),b(),r.init()});